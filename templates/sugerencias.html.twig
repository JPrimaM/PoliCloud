{# {% macro sugerencias(imagen) %} #}
{% macro sugerencias(imagen, likes) %}

<div class="row px-0 ">

    {#
        < pre >
        {{dump(sugeridos_imagen.sugerenciasAleatorias[0].callable[1])}}
</pre> #}

    <div class="col mt-5">
        <p><span class="h4 ms-1 me-3">Sugerencias</span>Algunas publicaciones de los usuarios</p>
        <div class="row text-center">
            <div class="col-4 px-5">
                <div class="mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="height-20 bi bi-circle-fill text-primary" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg>
                    <a class="link-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-fill dots-size" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>
                    </a>
                </div>

                {% for contador, multimedia in sugeridos_imagen.sugerenciasAleatorias[0].callable[1] %}
                <div class="col">
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4 visor">
                            <a type="button" class="m-0 p-0" data-bs-toggle="modal"
                                data-bs-target="#modalVerImagen{{ multimedia.id }}">
                                <img src="data:image/png;base64,{{ multimedia.archivo }}" alt="IMAGEN" class="img-fluid rounded-start">
                                </a>
                            </div>
                            <div class="col-md-8">
                                <div class="card-body p-2 text-start">
                                    <p class="fsize-15 mb-0 ms-2">{{ multimedia.usuario.apodo }}</p>
                                    <p class="fsize-15 mb-0 ms-2">{{ multimedia.nombre }}</p>
                                    <p class="fsize-15 mb-0 me-2 text-end text-muted"><span id="numLikes">{% if not multimedia.likes == null %}{{ multimedia.likes }}{% else %}0{% endif %}</span>
                                        
                                        
                                        {% if likes == "" %} {# En caso de que no haya usuario logged #}
                                            <a onclick="darLike(this)" id="{{ multimedia.id }}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star p-0 m-0 btn link-primary" viewBox="0 0 16 16">
                                                <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                                </svg>
                                            </a>
                                        {% else %} {# Si está dentro... #}
                                            {% set break = false %}
                                            {% for like in likes %} {# ...comprueba que las IDs de LIKES (Colecciones Multimedia y Usuario) coincidan con la Multimedia cargada y el Usuario logged y asigna "like" si es así #}
                                                {% if like.id == multimedia.id and like.usuario.id == multimedia.usuario.id %}
                                                    <a onclick="darLike(this)" id="{{ multimedia.id }}">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill link-primary" viewBox="0 0 16 16">
                                                        <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </a>
                                                    {% set break = true %}
                                                {% endif %}
                                            {% endfor %}
                                            {% if break == false %} {# ...en caso de no encontrar ninguná coincidencia asigna "no-like" #}
                                                <a onclick="darLike(this)" id="{{ multimedia.id }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star p-0 m-0 btn link-primary" viewBox="0 0 16 16">
                                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                                    </svg>
                                                </a>
                                            {% endif %}
                                        {% endif %}
                                    
                                        {# {{ dump(likes[contador]) }} #}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
{#              {{ dump(multimedia.usuario) }} 
                {{ dump(multimedia.usuario) }}  #}

    
                {# MODAL IMAGEN #}
                <div class="modal fade" id="modalVerImagen{{ multimedia.id }}" tabindex="-1" aria-labelledby="modalVerImagenLabel{{ multimedia.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalVerImagenLabel{{ multimedia.id }}">

                                {% if multimedia.usuario.imagen %}
                                    <img src="data:image/png;base64,{{ multimedia.usuario.imagen }}" alt="mdo" width="28" height="28"
                                            class="rounded-circle">                                    
                                {% else %}
                                    {% if multimedia.usuario.imagen == null %}
                                        <img src="data:image/png;base64,{{ imagen }}" alt="mdo" width="28" height="28"
                                            class="rounded-circle">
                                    {% else %}
                                        
                                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                            class="bi bi-person-circle" viewBox="0 0 16 16">
                                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                                            <path fill-rule="evenodd"
                                                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                                        </svg>
                                    {% endif %}
                                {% endif %}
                                {{ multimedia.usuario.apodo }}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <img src="data:image/png;base64,{{ multimedia.archivo }}" alt="IMAGEN" class="img-fluid rounded-start mb-3">
                                <p class="fsize-15 mb-0 ms-2">{{ multimedia.nombre }}</p>
                                <p class="fsize-15 mb-0 ms-2">{{ multimedia.descripcion }}</p>
                                <p class="fsize-15 mb-0 me-2 text-end text-muted">{% if not multimedia.likes == null %}{{ multimedia.likes }}{% else %}0{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {# FIN MODAL IMAGEN #}
                {% endfor %}
            </div>
            <div class="col-4 px-5">
                <div class="mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="height-20 bi bi-circle-fill text-primary" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg>
                    <a class="link-dark">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-fill dots-size" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>
                    </a>
                </div>
                {# {% for multimedia in sugeridos_musica.sugerenciasAleatorias[1].callable[1] %}
                <div class="col">
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="{{ asset('img/video/modelo_astro.gif') }}" class="img-fluid rounded-start"
                                    alt="Video destacado 1">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body p-2 text-start">
                                    <p class="fsize-15 mb-0 ms-2">{{ multimedia.usuario.apodo }}</p>
                                    <p class="fsize-15 mb-0 ms-2">{{ multimedia.nombre }}</p>
                                    <p class="fsize-15 mb-0 me-2 text-end text-muted">{% if not multimedia.likes == null
                                        %}{{ multimedia.likes }}{% else %}0{% endif %}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %} #}
            </div>
            <div class="col-4 px-5">
                <div class="mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="height-20 bi bi-circle-fill text-primary" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg>
                    <a class="link-light">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-fill dots-size" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>
                    </a>
                </div>
                {# <div class="col">
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="{{ asset('img/video/modelo_astro.gif') }}" class="img-fluid rounded-start"
                                    alt="Video destacado 1">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body p-2 text-start">
                                    <p class="fsize-15 mb-0 ms-2">NomArtista
                                    <p class="fsize-15 mb-0 ms-2">NomCanción</p>
                                    <p class="fsize-15 mb-0 me-2 text-end text-muted">15</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> #}
            </div>
        </div>
    </div>

    <script>
		function darLike(elemento) {
/*            var data = new FormData();
            data.append("multimedia_id", elemento.id);

            console.log(elemento.id)

            fetch("/dar-like", {
                method: "POST",
                body: data

            }).then(function (data) {
                elemento.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star p-0 m-0 btn link-primary" viewBox="0 0 16 16"><path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/></svg>'
            }).catch(function (err) {
                elemento.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill p-0 m-0 btn link-primary" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>'
                console.log('error:' + err);
            });
            };
 */
            if (elemento.id.length == 0) {
                
                return;
            } else {
                const xmlhttp = new XMLHttpRequest();
                xmlhttp.onload = function() {
                    console.log(elemento);
                    
                    elemento.innerHTML = '\<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill link-primary" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>';
                }
            xmlhttp.open("GET", "dar-like?multimedia_id="+elemento.id);
            xmlhttp.send();
            
            }
        }

	</script>
    

    
{% endmacro %}